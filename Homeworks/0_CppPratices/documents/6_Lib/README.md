# 6. 静态库

> **注：** 如果你正在接受这些编程训练，表示你已经同意我们之间的版权协议。请严禁将这些练习的代码（包括你自己的代码）在不经允许的情况下在公共网上公布和散播。一经发现，后果自负。谢谢！－刘利刚 (ligang.liu@gmail.com)

## 程序库

所谓**程序库**，一般是软件作者为了发布方便、替换方便或二次开发目的，而发布的一组可以单独与应用程序进行 compile time 或 runtime 链接的二进制可重定位目标码文件。通俗一点说，所谓一个库，就是一个文件，这个文件可以在编译时由编译器直接链接到可执行程序中，也可以在运行时由操作系统的 runtime enviroment 根据需要动态加载到内存中。一组库，就形成了一个发布包，当然，具体发布多少个库，完全由库提供商自己决定。

所谓**静态库**，就是在静态编译时由编译器到指定目录寻找并且进行链接，一旦链接完成，最终的可执行程序中就包含了该库文件中的所有有用信息，包括代码段、数据段等。所谓动态库，就是在应用程序运行时，由操作系统根据应用程序的请求，动态到指定目录下寻找并装载入内存中，同时需要进行地址重定向。 win32 平台下，静态库通常后缀为 .lib，动态库为 .dll。相对于动态库，静态库的优点在于直接被链接进可执行程序中，之后，该可执行程序就不再依赖于运行环境的设置了（当然仍然会依赖于 CPU 指令集和操作系统支持的可执行文件格式等硬性限制）。而动态库的优点在于，用户甚至可以在程序运行时随时替换该动态库，这就构成了动态插件系统的基础。具体使用静态库和动态库，由程序员根据需要自己决定。

我们先学习编写和使用静态库(*.lib)。

## 生成静态库 (*.lib)

参照 [CMake 教程](https://cmake.org/cmake/help/latest/guide/tutorial/index.html) 的 step 2

在使用 CMake 时，需要用到 [project/cmake/UbpaTool.cmake](../../project/cmake/UbpaTool.cmake) 的函数 `Ubpa_SetupTarget`，调用方法为

```cmake
Ubpa_SetupTarget(MODE "LIB" NAME <target-name> SOURCES <sources> LIBS <libs>)
```

## 使用静态库 (*.lib)

参照 [CMake 教程](https://cmake.org/cmake/help/latest/guide/tutorial/index.html) 的 step 2

## 作业要求

- 学会生成静态库 lib 及使用静态库；
- 你可在网上查找到更多有关静态库的知识，稍微学习和体会一下；
- 将作业 1.4 的 `polynomial` 编写成静态库 `lib`，测试使用后将工程发给我检查。

## 目的

- 务必体会和学会使用静态库；
- 以后在网上会有大量的程序不会提供源代码，只提供头文件和静态库文件，你需要通过看文档和头文件接口来使用它们。

